# 2026-01-30 Session Notes

## OpenJimmy (iMessage Plugin) - Major Updates

### Features Implemented (v1.1.0)
- **Image/media attachments** - Uses OpenClaw's MediaPaths/MediaTypes pipeline so vision models can actually see images (not just text descriptions)
- **Tapback reactions** - Receive üëç‚ù§Ô∏èüòÇ‚ÄºÔ∏è‚ùìüëé as messages
- **Reply threading** - Detect quoted replies, context available in metadata
- **Contact name resolution** - Queries AddressBook database to show names instead of phone numbers

### Critical Bug Fix: Zombie Duplicate Instances
**Problem:** Hot reload (SIGUSR1) creates new poll loop instances but old ones keep running. Multiple instances (up to 6!) process the same message.

**Solution:** Active instance file (`~/.openclaw/imessage-active-instance`)
- On startup, new instance writes its ID to file
- Poll loop checks if it's still the active instance before processing
- Old zombies see they're not active and stop themselves
- Only works after FULL process restart (not hot reload) to kill pre-existing zombies

**Key insight:** Module-level variables reset on hot reload, but `setTimeout` callbacks persist. Global object survives reload but old code doesn't have the check. File-based coordination is the only reliable cross-reload solution.

### Other Fixes
- Removed reply/tapback text truncation (was 100 chars, now full text)
- Reply context passed as metadata, not injected into message body (less clutter)

### Repo
- GitHub: woodbeary/openjimmy
- Also synced to woodbeary/jimmytimmy (clawd workspace)

## Watchdog Script
Updated `~/clawd/watchdog.sh` to be a safe gateway health monitor:
- Only restarts if gateway is actually down
- No side effects that could kill gateway
- Runs via cron every 5 minutes

## User Preferences Learned
- **Communicate during work** - Tell user what I'm working on before/during/after, not just final answers
- **Don't restart gateway without asking** - I often don't come back properly
- **Test before pushing** - Don't push to openjimmy unless validated working
- **No unnecessary truncation** - Show full quoted text

## Technical Notes
- Gateway restart via SIGUSR1 = hot reload (old event loops persist)
- Gateway stop + start = full restart (kills everything)
- `openclaw doctor` can recover crashed gateway
